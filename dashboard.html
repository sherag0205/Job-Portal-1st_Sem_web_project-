<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard - JobPortal</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="animations.css">
    <script src="animations.js" defer></script>
</head>
<body>
    <!-- Header -->
    <header>
        <a href="index.html" class="logo">
            <div class="logo-icon">JP</div>
            <span>JobPortal</span>
        </a>
        <nav class="desktop-nav">
            <a href="jobs.html">Find Jobs</a>
            <a href="about.html">Companies</a>
            <a href="contact.html">Contact</a>
        </nav>
        <div class="auth-buttons">
            <!-- Auth buttons will be populated by JavaScript -->
        </div>
        <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
    </header>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay">
        <div class="mobile-menu-content">
            <nav class="mobile-nav">
                <a href="jobs.html">Find Jobs</a>
                <a href="about.html">Companies</a>
                <a href="contact.html">Contact</a>
                <div class="mobile-auth-buttons">
                    <!-- Mobile auth buttons will be populated by JavaScript -->
                </div>
            </nav>
        </div>
    </div>

    <!-- Dashboard Container -->
    <div class="dashboard-container scroll-fade-in">
        <div class="dashboard-header">
            <h1>My Dashboard</h1>
            <p>Welcome back! Manage your saved jobs and track your progress.</p>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Sidebar -->
            <aside class="dashboard-sidebar">
                <nav class="dashboard-nav">
                    <a href="#" class="dashboard-nav-item active" onclick="showDashboardTab('saved', event)">
                        <span class="nav-icon">♡</span>
                        <span>Saved Jobs</span>
                        <span class="badge" id="saved-count">0</span>
                    </a>
                    <a href="#" class="dashboard-nav-item" onclick="showDashboardTab('applied', event)">
                        <span class="nav-icon">✓</span>
                        <span>Applied Jobs</span>
                        <span class="badge" id="applied-count">0</span>
                    </a>
                    <a href="#" class="dashboard-nav-item" onclick="showDashboardTab('alerts', event)">
                        <span class="nav-icon"><!-- add icone --></span>
                        <span>Job Alerts</span>
                    </a>
                    <a href="#" class="dashboard-nav-item employer-only" onclick="showDashboardTab('create-job', event)">
                        <span class="nav-icon"><!-- add icone --></span>
                        <span>Post a Job</span>
                    </a>
                    <a href="#" class="dashboard-nav-item" onclick="showDashboardTab('profile', event)">
                        <span class="nav-icon"><!-- add icone --></span>
                        <span>My Profile</span>
                    </a>
                    <a href="#" class="dashboard-nav-item" onclick="showDashboardTab('settings', event)">
                        <span class="nav-icon"><!-- add icone --></span>
                        <span>Settings</span>
                    </a>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="dashboard-main">
                <!-- Saved Jobs Tab -->
                <div class="dashboard-tab active" id="saved-tab">
                    <div class="tab-header">
                        <h2>Saved Jobs</h2>
                        <p id="saved-info">You haven't saved any jobs yet</p>
                    </div>
                    <div id="saved-jobs-list" class="jobs-list">
                        <!-- Saved jobs will be populated here -->
                    </div>
                </div>

                <!-- Applied Jobs Tab -->
                <div class="dashboard-tab" id="applied-tab">
                    <div class="tab-header">
                        <h2>Applied Jobs</h2>
                        <p id="applied-info">You haven't applied to any jobs yet</p>
                    </div>
                    <div id="applied-jobs-list" class="jobs-list">
                        <!-- Applied jobs will be populated here -->
                    </div>
                </div>

                <!-- Job Alerts Tab -->
                <div class="dashboard-tab" id="alerts-tab">
                    <div class="tab-header">
                        <h2>Job Alerts</h2>
                    </div>
                    <div class="alerts-setup">
                        <div class="alert-form scroll-fade-in">
                            <h3>Create a Job Alert</h3>
                            <p>Get notified about new jobs that match your interests</p>
                            <input type="text" placeholder="Job title (e.g., Designer)" id="alertJobTitle" class="form-input">
                            <input type="text" placeholder="Location (e.g., New York)" id="alertLocation" class="form-input">
                            <label class="checkbox-label">
                                <input type="checkbox" id="alertDaily"> Daily digest
                            </label>
                            <button class="btn btn-primary" onclick="createJobAlert()">Create Alert</button>
                        </div>
                        <div id="alerts-list">
                            <!-- Alerts will be shown here -->
                        </div>
                    </div>
                </div>

                <!-- Create Job Tab (Employer Only) -->
                <div class="dashboard-tab employer-only" id="create-job-tab">
                    <div class="tab-header">
                        <h2>Post a Job</h2>
                    </div>
                    <div class="job-form scroll-fade-in">
                        <form id="jobPostForm" onsubmit="handleJobPost(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Job Title *</label>
                                    <input type="text" id="jobTitle" class="form-input" placeholder="e.g., Senior Product Designer" required>
                                </div>
                                <div class="form-group">
                                    <label>Company *</label>
                                    <input type="text" id="jobCompany" class="form-input" placeholder="e.g., Tech Startup Inc." required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Location *</label>
                                    <input type="text" id="jobLocation" class="form-input" placeholder="e.g., New York, NY" required>
                                </div>
                                <div class="form-group">
                                    <label>Job Type *</label>
                                    <select id="jobType" class="form-input" required>
                                        <option value="">Select type</option>
                                        <option value="Full-time">Full-time</option>
                                        <option value="Part-time">Part-time</option>
                                        <option value="Contract">Contract</option>
                                        <option value="Freelance">Freelance</option>
                                        <option value="Internship">Internship</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Category *</label>
                                    <select id="jobCategory" class="form-input" required>
                                        <option value="">Select category</option>
                                        <option value="Design">Design</option>
                                        <option value="Technology">Technology</option>
                                        <option value="Marketing">Marketing</option>
                                        <option value="Sales">Sales</option>
                                        <option value="Finance">Finance</option>
                                        <option value="Healthcare">Healthcare</option>
                                        <option value="Education">Education</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Salary Range</label>
                                    <input type="text" id="jobSalary" class="form-input" placeholder="e.g., $80k - $120k">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Job Description *</label>
                                <textarea id="jobDescription" class="form-textarea" placeholder="Describe the role, responsibilities, and what you're looking for in a candidate..." rows="6" required></textarea>
                            </div>

                            <div class="form-group">
                                <label>Requirements</label>
                                <textarea id="jobRequirements" class="form-textarea" placeholder="List the key requirements and qualifications (one per line)..." rows="4"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Benefits</label>
                                <textarea id="jobBenefits" class="form-textarea" placeholder="List the benefits and perks (one per line)..." rows="4"></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem;">Post Job</button>
                        </form>
                    </div>
                </div>

                <!-- Profile Tab -->
                <div class="dashboard-tab" id="profile-tab">
                    <div class="tab-header">
                        <h2>My Profile</h2>
                    </div>
                    <div class="profile-form scroll-fade-in">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="profileName" class="form-input" placeholder="Your name">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="profileEmail" class="form-input" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label>Professional Title</label>
                            <input type="text" id="profileTitle" class="form-input" placeholder="e.g., Product Designer">
                        </div>
                        <div class="form-group">
                            <label>Bio</label>
                            <textarea id="profileBio" class="form-textarea" placeholder="Tell us about yourself" rows="4"></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="saveProfile()">Save Profile</button>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="dashboard-tab" id="settings-tab">
                    <div class="tab-header">
                        <h2>Settings</h2>
                    </div>
                    <div class="settings-form scroll-fade-in">
                        <div class="setting-item">
                            <div class="setting-content">
                                <h4>Email Notifications</h4>
                                <p>Receive updates about new jobs and applications</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="emailNotif" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-content">
                                <h4>Dark Mode</h4>
                                <p>Switch to dark theme</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="darkMode" onchange="toggleDarkMode()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item danger">
                            <div class="setting-content">
                                <h4>Delete Account</h4>
                                <p>Permanently delete your account and all data</p>
                            </div>
                            <button class="btn btn-danger" onclick="if(confirm('Are you sure?')) alert('Account deleted')">Delete</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="scroll-fade-in">
        <div class="footer-content">
            <div class="footer-section scroll-slide-up">
                <div class="footer-brand">
                    <div class="footer-logo-icon">JP</div>
                    JobPortal
                </div>
                <p class="footer-desc">The world's leading professional network for finding your next career milestone.</p>
            </div>
            <div class="footer-section scroll-slide-up">
                <h4>Quick Links</h4>
                <div class="footer-links">
                    <a href="jobs.html">Browse Jobs</a>
                    <a href="about.html">About Us</a>
                    <a href="contact.html">Contact</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom scroll-slide-up">
            <span>© 2024 JobPortal Inc. All rights reserved.</span>
        </div>
    </footer>

<script src="authDatabase.js"></script>
    <script src="jobDatabase.js"></script>
    <script src="script.js" defer></script>
    <script>
        // Check authentication on page load
        function checkAuthOnDashboard() {
            if (!authDB.isAuthenticated()) {
                showNotification('Please login to access the dashboard', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
                return;
            }

            const user = authDB.getCurrentUser();
            // Update dashboard header with role
            const dashboardHeader = document.querySelector('.dashboard-header');
            if (dashboardHeader) {
                dashboardHeader.innerHTML = `
                    <h1>My Dashboard</h1>
                    <p>Welcome back, ${user.email}! You are logged in as <strong>${user.role === 'job-seeker' ? 'Job Seeker' : 'Employer'}</strong></p>
                `;
            }

            // Show/hide employer tabs based on role
            const employerTabs = document.querySelectorAll('.employer-only');
            employerTabs.forEach(tab => {
                if (user.role === 'employer') {
                    tab.style.display = 'block';
                } else {
                    tab.style.display = 'none';
                }
            });
        }

        function showDashboardTab(tabName, event) {
            event.preventDefault();
            
            // Hide all tabs
            document.querySelectorAll('.dashboard-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from nav items
            document.querySelectorAll('.dashboard-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.closest('.dashboard-nav-item').classList.add('active');
        }

        function createJobAlert() {
            const title = document.getElementById('alertJobTitle').value;
            const location = document.getElementById('alertLocation').value;

            if(!title || !location) {
                showNotification('Please fill in all fields', 'warning');
                return;
            }

            try {
                const alert = authDB.addJobAlert({
                    title: title,
                    location: location,
                    daily: document.getElementById('alertDaily').checked
                });

                showNotification(`Alert created for ${title} jobs in ${location}`, 'success');
                document.getElementById('alertJobTitle').value = '';
                document.getElementById('alertLocation').value = '';
                loadJobAlerts();
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        function saveProfile() {
            const name = document.getElementById('profileName').value;
            const email = document.getElementById('profileEmail').value;
            const title = document.getElementById('profileTitle').value;
            const bio = document.getElementById('profileBio').value;

            if(!name || !email) {
                showNotification('Please fill in all required fields', 'warning');
                return;
            }

            try {
                authDB.updateProfile({
                    name: name,
                    title: title,
                    bio: bio
                });

                showNotification('Profile saved successfully!', 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
        }

        function loadSavedJobs() {
            const savedJobIds = authDB.getSavedJobs();
            const savedJobs = jobsDatabase.filter(job => savedJobIds.includes(job.id));
            const list = document.getElementById('saved-jobs-list');

            if(savedJobs.length === 0) {
                document.getElementById('saved-info').textContent = 'You haven\'t saved any jobs yet';
                list.innerHTML = '';
            } else {
                document.getElementById('saved-info').textContent = `${savedJobs.length} job(s) saved`;
                list.innerHTML = savedJobs.map(job => `
                    <div class="saved-job-card scroll-fade-in">
                        <div class="saved-job-header">
                            <h3>${job.title}</h3>
                            <button onclick="removeSavedJob('${job.id}')" class="btn-remove">✕</button>
                        </div>
                        <p class="company-name">${job.company}</p>
                        <p class="job-location">${job.location}</p>
                        <button onclick="selectJob('${job.id}')" class="btn btn-primary">View Details</button>
                    </div>
                `).join('');
            }
            document.getElementById('saved-count').textContent = savedJobs.length;
        }

        function loadJobAlerts() {
            const alerts = authDB.getJobAlerts();
            const alertsList = document.getElementById('alerts-list');

            if(alerts.length === 0) {
                alertsList.innerHTML = '<p style="color: #999; padding: 2rem; text-align: center;">No job alerts created yet</p>';
            } else {
                alertsList.innerHTML = alerts.map(alert => `
                    <div class="alert-item scroll-fade-in" style="border: 1px solid #ddd; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <strong>${alert.title}</strong> in <strong>${alert.location}</strong>
                                <p style="color: #999; font-size: 0.85rem; margin-top: 0.5rem;">Created ${new Date(alert.createdAt).toLocaleDateString()}</p>
                            </div>
                            <button onclick="removeAlert('${alert.id}')" style="background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 1.2rem;">✕</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function removeSavedJob(jobId) {
            try {
                authDB.removeSavedJob(parseInt(jobId));
                loadSavedJobs();
            } catch (error) {
                alert(error.message);
            }
        }

        function handleJobPost(event) {
            event.preventDefault();

            const jobData = {
                title: document.getElementById('jobTitle').value,
                company: document.getElementById('jobCompany').value,
                location: document.getElementById('jobLocation').value,
                type: document.getElementById('jobType').value,
                category: document.getElementById('jobCategory').value,
                salary: document.getElementById('jobSalary').value,
                description: document.getElementById('jobDescription').value,
                fullDescription: document.getElementById('jobDescription').value,
                requirements: document.getElementById('jobRequirements').value.split('\n').filter(req => req.trim()),
                benefits: document.getElementById('jobBenefits').value.split('\n').filter(benefit => benefit.trim()),
                avatar: document.getElementById('jobCompany').value.charAt(0).toUpperCase(),
                avatarGradient: 'linear-gradient(135deg, #4A90E2 0%, #357ABD 100%)',
                posted: 'Just now'
            };

            // Validate required fields
            if (!jobData.title || !jobData.company || !jobData.location || !jobData.type || !jobData.category || !jobData.description) {
                showNotification('Please fill in all required fields', 'warning');
                return;
            }

            // Generate new ID
            const newId = Math.max(...jobsDatabase.map(job => job.id)) + 1;
            jobData.id = newId;

            // Add to jobs database
            jobsDatabase.push(jobData);

            // Save to localStorage for persistence
            localStorage.setItem('jobsDatabase', JSON.stringify(jobsDatabase));

            showNotification(`Job "${jobData.title}" posted successfully!`, 'success');
            document.getElementById('jobPostForm').reset();

            // Optionally redirect to jobs page to see the new job
            setTimeout(() => {
                if (confirm('Job posted! Would you like to view all jobs?')) {
                    window.location.href = 'jobs.html';
                }
            }, 1000);
        }

        function loadUserProfile() {
            const user = authDB.getCurrentUser();
            const profile = authDB.getProfile();

            if (user) {
                document.getElementById('profileEmail').value = user.email;
            }

            if (profile) {
                document.getElementById('profileName').value = profile.name || '';
                document.getElementById('profileTitle').value = profile.title || '';
                document.getElementById('profileBio').value = profile.bio || '';
            }
        }

        // Load dark mode preference
        function loadDarkModePreference() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkMode').checked = true;
            }
        }

        // Load saved jobs on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthOnDashboard();
            initMobileMenu();
            updateNavigationUI();
            loadSavedJobs();
            loadJobAlerts();
            loadUserProfile();
            loadDarkModePreference();
        });
    </script>
</body>
</html>
